jobs:
  scan:
    runs-on: ubuntu-latest
    env:
      LW_ACCOUNT: ${{ secrets.LW_ACCOUNT }}
      LW_ACCESS_TOKEN: ${{ secrets.LW_ACCESS_TOKEN }}

    steps:
      - uses: actions/checkout@v3

      - name: Install lw-scanner
        run: |
          curl -sL https://github.com/lacework/lw-scanner/releases/latest/download/lw-scanner-linux-amd64 \
            -o /usr/local/bin/lw-scanner
          chmod +x /usr/local/bin/lw-scanner

      - name: Configure auth non-interactively
        run: |
          mkdir -p ~/.lacework
          cat <<EOF > ~/.lacework.toml
[default]
account = "${LW_ACCOUNT}"
access_token = "${LW_ACCESS_TOKEN}"
EOF

      - name: Scan Dockerfile
        run: lw-scanner dockerfile evaluate ./Dockerfile --save
